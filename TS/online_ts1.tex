Пусть $\mathsf{X} = (x_1,\ldots,x_N)$ --- последовательность измерений, ряд длины $N$.
Обычно $n$ --- это время, а $x_i = f(\delta i)$ --- измерения некоторой функции с равным шагом. Часто измерения содержат случайные ошибки, называемые шумом (позже сформулируем, как формализуется шум).

Примеры с картинками: ...

Задача: выявить структуру во временном ряде и ее спрогнозировать. Давайте разберемся, что это за структура.

Важно понимать, что нельзя просто прогнозировать временной ряд, можно повторять в будущем только что-то, что было обнаружено в настоящем. Далее мы коротко коснемся таких закономерностей.

Замечание. В принципе, не всегда ставят задачу прогноза. Например, ставят задачу выделения тренда (тенденции). Но зачем? Очень часто - чтобы мысленно продолжить ее в будущее.

Задача анализа временного ряда тоже можно быть важна сама по себе, в том числе, с исторической точки зрения. Задачу анализа временного ряда можно пробовать рассматривать как чисто математическую. К сожалению, задача прогнозирования не является математической и невозможно гарантировать какие-то свойства прогноза, так как продолжаемая в будущем структура может поменяться в силу внешних обстоятельств.

\section{Первый тип рядов: тренд + периодическая компонента + шум = сигнал + шум.}
$x_n = t_n + p_n +\epsilon_n = s_n+\epsilon_n$, $\mathbb{E} \epsilon_n = 0$.

Сигнал --- неслучайная (детерминированная) составляющая ряда, в нем и содержится структура для такого типа рядов.

\paragraph{Тренд}
Нет одного формального определения:\\
самое общее --- медленно меняющаяся составляющая временного ряда\\
параметрическое: аппроксимация ряда из какого-то параметрического семейства, например, линейные функции или полиномы порядка не больше, чем заданный. Терминология: линейный тренд, полиномиальный тренд.

Параметрические виды тренда: линейный $t_n = an+b$, квадратичный $t_n = an^2+bn+c$, экспоненциальный $t_n = C\exp{\alpha n}$.

Замечание: $\exp{\alpha n} = \rho^n$ при $\rho = \exp{\alpha}$. Поэтому функцию $C\rho^n$ тоже называют экспоненциальной. Обычно $C>0$. Тогда, если $\alpha>0$ ($\rho>1$), то это возрастающая экспонента, если там равенство, то это константа; иначе --- убывающая к нулю экспонента.

Примеры с картинками.

То, что нет точного определения, объективно. В частности, понятие медленных изменений явно зависит от той части ряда, которую наблюдаем. Например, синус для большой промежутке --- явно не тренд, а на промежутке типа четверть периода не отличим от тренда.

Имеет смысл отличать от тенденции: тенденция обычно монотонно возрастает или убывает.

Часто в стат.пакетах под словом тренд понимают линейный тренд, а тренд в общем смысле представляют в виде тренда-тенденции и циклических (медленных нерегулярных колебаний).

Проблема с трендами: как правило, они определяются внешними условиями, т.е. плохо предсказуемы. Есть редкие случаи, когда тренд, например, экспоненциально растет (пример...), даже в этом случае экспоненциальный рост может прекратиться. Например, закон Мальтуса, когда количество людей растет по экспоненте, а количество еды/ресурсов  --- как линейная функций. Проблема! (хотя не знаю, как сейчас выглядит поведение числа людей и количества ресурсов)

Или: все было хорошо, издали плохой закон, все стало плохо (это условный пример, просто идея).

Или финансовый индекс S\&P рос экспоненциально, пока не случился кризис.

Иногда говорят о случайных трендах. Но это, скорее, относится уже к следующему подразделу.

\paragraph{Периодическая компонента}
Периодическая компонента с периодом $T$: то, что повторяется каждые $T$ точек:  $p_{n+T} = p_n$ для любого $n$.

Пример: синус с периодом $T$. Пишем формулу.

\vspace{5cm}
$p_n = A\cos(2\pi n/T + \phi) = A\cos(2\pi \omega n + \phi)$.

Запишите как сумму синуса и косинуса по формуле косинус суммы равен произведению косинусов минус произведение синусов. (Это потом пригодится в разложении Фурье.)

Частота $\omega = 1/T$. (Циклическая частота --- $2\pi/T$, но мы ее не будем использовать.)

$\phi$ --- фаза. С помощью фазы можно синус превращать в косинус и наоборот. Поэтому можно называть компоненту $A\cos(2\pi \omega n + \phi)$ гармоникой.

$A$ --- амплитуда.
Если амплитуда не константа, а медленно меняется (опять это неформальное выражение; имеется в виду, что существенно медленнее, чем сам синус/косинус), то гармоника называется модулированной. Например, $p_n =\exp{\alpha n} A\cos(2\pi \omega n + \phi)$ --- экспоненциально-модулированная гармоника.

Для временного ряда период может быть только целым, для косинуса/синуса - не обязательно.

Как, например, можно составить период 12 из шести косинусов (гармоник) с разными периодами?

%\vspace{5cm}
Ответ: cумма косинусов с периодами $12$, $6=12/2$, $4=12/3$, $3=12/4$, $2.4=12/5$, $2=12/6$.

Относительность понятия тренда: можно нарисовать растущую половину синуса, спросить, похоже ли на тренд (ответ - да), а потом дорисовать этот синус.

Периодичности, как правило, порождены внутренними свойствами временного ряда (мороженое чаще покупают летом), поэтому предсказывать периодичность --- гораздо более благодарная задача, чем предсказывать тренд.

Часто предсказывать нужно именно тренд/тенденцию. Тогда периодичность является мешающим фактором и ее удаляют (иначе, например, легко спутать сезонное уменьшение продаж с просто падением продаж (или наоборот). Экономические временные ряды часто выкладываются в виде seasonally adjusted, когда из ряда удаляется сезонная периодичность (шум остается).

\paragraph{Сигнал}
Если нет периодичности, то сигнал = тренд.

Без разделения на тренд и периодичность, сигнал можно определить как мат.ож. временного ряда, так как мат.ож. шума равно нулю, а сигнал не случайный.

\paragraph{Шум}

Шум --- в данной модели можно понимать как нерегулярные быстрые колебания вокруг нуля. Формально - это набор случайный величин с нулевым матем. ожиданием. Часто модель --- стационарный случайный процесс.

В данной модели шум --- мешающая компонента ряда,  его нужно устранять, подавлять и пр. В след. подразделе рассматривается структура случайного процесса, которая позволяет прогнозировать и его.

\paragraph{Методы}
Методы выделения тренда, методы разложения на компоненты, сглаживание, фильтры. Прогноз тренда и периодик.

\section{Второй тип рядов: ряд --- случайный процесс}

Случайный процесс (с дискретным временем) $\xi_1,\ldots,\xi_N$ состоит из последовательности случайных величин.
Т.е. это многомерный случайный вектор. Самый стандартный класс случайных процессов --- стационарные случайные процессы. Стац.процессы в слабом смысле: $\xi_k$ имеют одинаковое мат.ож. (часто равно нулю), одинаковую дисперсию и корреляция/ковариация зависит только от разницы во времени: $\mathrm{Cov}(\xi_t,\xi_s) =  V(t-s)$.

Если значения ряда --- случайные величины, то и прогноз (продолжение ряда) --- тоже случайная величина или некое распределение, которое задается плотностью или вероятностями, с которыми случаются те или иные исходы.

В этом случае точкой прогноза считается математическое ожидание этого распределения. Но более правильно строить предсказательный интервал, который показывает, какие значения могут случиться с заданной вероятностью, например, 0.95.

Например, $x_n = \epsilon_n$, $\mathbb{E}\epsilon_n = 0$, $\epsilon_n$ одинаково распределены и независимы между собой (iid --- independent, identically distributed). Это белый шум.
Структура? Предсказание?  Увы, структуры нет, среднее предсказания равно нулю.  Но если оценить разброс шума (стандартное отклонение $s$), то 95\% доверительный интервал --- $(\pm 1.96 s)$. Даже такая информация полезна. Если что-то в регулярном режиме колеблется как белый шум, то при выходе из предсказательного интервала несколькими значениями подряд можно делать вывод о том, что что-то сломалось.

Другой пример: $x_n = \phi x_{n-1}+ \sigma\epsilon_n$. Вопрос: если $\sigma=0$, то как ведет себя ряд при разных $\phi$? Ответ: получили экспоненциальный ряд, который стремится к нулю при $\phi<1$. Это не случайный и не стационарный ряд.

Оказывается, что если $|\phi|<1$ и добавить белый шум на каждом шаге, то получим стационарный случайный процесс. Если $\phi$ еще и больше 0, то этот процесс называется красным шумом. За счет чего такие процессы можно прогнозировать? За счет корреляции: $\rho(\xi_n,\xi_{n+1})= \phi$.

А что будет, если $\phi = 1$? Это называется броуновским движением: $x_n = x_{n-1}+\epsilon_n$.
Это НЕстационарный случайный процесс. У него растет стандартное отклонение (корень из дисперсии) как $\sqrt{n}$.
Однако, если перейти к последовательным разностям: $y_n = x_{n+1} - x_n$, то получим стационарный процесс (белый шум). В этом случае говорят, что ряд имел случайный тренд.

\paragraph{Методы}

Авторегрессия (ARIMA, Seasonal ARIMA), экспоненциальное сглаживание (ETS).

\section{О чем пойдет речь в данном курсе}

TODO